<!--
    DEPRECATED: This template is deprecated and will be replaced by React components.
    Date: 2025-09-26
    Migration: Locrits list being rebuilt as React component with real-time updates
-->
{% extends "base.html" %}

{% block title %}Mes Locrits - Locrit{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Mes Locrits</h1>
    <a href="{{ url_for('create_locrit') }}" class="btn btn-primary">
        ‚ûï Nouveau Locrit
    </a>
</div>

{% if locrits %}
    <div class="card">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Nom</th>
                        <th>Description</th>
                        <th>Statut</th>
                        <th>Mod√®le</th>
                        <th>Adresse publique</th>
                        <th>Cr√©√©</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for locrit in locrits %}
                    <tr>
                        <td>
                            <strong>{{ locrit.name }}</strong>
                        </td>
                        <td>
                            <span title="{{ locrit.description }}">
                                {{ locrit.description[:80] }}{% if locrit.description|length > 80 %}...{% endif %}
                            </span>
                        </td>
                        <td>
                            {% if locrit.active %}
                                <span class="badge badge-success">üü¢ Actif</span>
                            {% else %}
                                <span class="badge badge-danger">üî¥ Inactif</span>
                            {% endif %}
                        </td>
                        <td>
                            <code>{{ locrit.model }}</code>
                        </td>
                        <td>
                            {% if locrit.public_address %}
                                <a href="http://{{ locrit.public_address }}" target="_blank" class="text-primary">
                                    {{ locrit.public_address }}
                                </a>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td class="text-muted">
                            {% if locrit.created_at %}
                                {{ locrit.created_at[:10] }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <div class="d-flex gap-2">
                                <!-- Chat -->
                                <a href="{{ url_for('chat_with_locrit', locrit_name=locrit.name) }}"
                                   class="btn btn-sm btn-primary"
                                   title="Discuter avec {{ locrit.name }}"
                                   {% if not locrit.active %}style="opacity: 0.6;"{% endif %}>
                                    üí¨
                                </a>

                                <!-- Toggle status -->
                                <button class="btn btn-sm btn-outline toggle-locrit"
                                        data-locrit="{{ locrit.name }}"
                                        title="{% if locrit.active %}D√©sactiver{% else %}Activer{% endif %}">
                                    {% if locrit.active %}‚èπÔ∏è{% else %}‚ñ∂Ô∏è{% endif %}
                                </button>

                                <!-- Edit -->
                                <a href="{{ url_for('edit_locrit', locrit_name=locrit.name) }}"
                                   class="btn btn-sm btn-outline"
                                   title="√âditer">
                                    ‚öôÔ∏è
                                </a>

                                <!-- View details -->
                                <button class="btn btn-sm btn-outline view-details"
                                        data-locrit="{{ locrit.name }}"
                                        title="Voir les d√©tails">
                                    üìÑ
                                </button>

                                <!-- Delete -->
                                <button class="btn btn-sm btn-danger delete-locrit"
                                        data-locrit="{{ locrit.name }}"
                                        title="Supprimer">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                    </tr>

                    <!-- Row for details (hidden by default) -->
                    <tr id="details-{{ loop.index }}" class="locrit-details" style="display: none;">
                        <td colspan="7">
                            <div class="card" style="margin: 0; border: none; background-color: #f8fafc;">
                                <div class="d-flex gap-4">
                                    <!-- Open to settings -->
                                    <div style="flex: 1;">
                                        <h5>üîê Ouvert √†</h5>
                                        <ul style="list-style: none; padding: 0; font-size: 0.875rem;">
                                            <li>üë• Humains: {% if locrit.open_to.humans %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>ü§ñ Autres Locrits: {% if locrit.open_to.locrits %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>üìß Invitations: {% if locrit.open_to.invitations %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>üåê Internet: {% if locrit.open_to.internet %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>üè¢ Plateforme: {% if locrit.open_to.platform %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                        </ul>
                                    </div>

                                    <!-- Access to settings -->
                                    <div style="flex: 1;">
                                        <h5>üìä Acc√®s aux donn√©es</h5>
                                        <ul style="list-style: none; padding: 0; font-size: 0.875rem;">
                                            <li>üìù Logs: {% if locrit.access_to.logs %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>üß† M√©moire rapide: {% if locrit.access_to.quick_memory %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>üóÑÔ∏è M√©moire compl√®te: {% if locrit.access_to.full_memory %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                            <li>ü§ñ Infos LLM: {% if locrit.access_to.llm_info %}‚úÖ{% else %}‚ùå{% endif %}</li>
                                        </ul>
                                    </div>

                                    <!-- Metadata -->
                                    <div style="flex: 1;">
                                        <h5>üìÖ Informations</h5>
                                        <div style="font-size: 0.875rem;">
                                            <p><strong>Cr√©√©:</strong><br>{{ locrit.created_at[:19] if locrit.created_at else 'N/A' }}</p>
                                            <p><strong>Modifi√©:</strong><br>{{ locrit.updated_at[:19] if locrit.updated_at else 'N/A' }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% else %}
    <div class="card">
        <div class="text-center" style="padding: 3rem;">
            <h3>üè† Aucun Locrit configur√©</h3>
            <p class="text-muted mb-4">Vous n'avez pas encore cr√©√© de Locrit. Commencez par en cr√©er un !</p>
            <a href="{{ url_for('create_locrit') }}" class="btn btn-primary">
                ‚ûï Cr√©er mon premier Locrit
            </a>
        </div>
    </div>
{% endif %}

<!-- Modal de confirmation de suppression -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 0.5rem; min-width: 400px;">
        <h3>Confirmer la suppression</h3>
        <p>√ätes-vous s√ªr de vouloir supprimer le Locrit <strong id="deleteLocritName"></strong> ?</p>
        <p class="text-danger">Cette action est irr√©versible.</p>
        <div class="d-flex gap-2 justify-content-end mt-4">
            <button id="cancelDelete" class="btn btn-outline">Annuler</button>
            <button id="confirmDelete" class="btn btn-danger">Supprimer</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Toggle Locrit status
document.querySelectorAll('.toggle-locrit').forEach(button => {
    button.addEventListener('click', async function() {
        const locritName = this.dataset.locrit;
        const originalText = this.innerHTML;

        try {
            this.disabled = true;
            this.innerHTML = '‚è≥';

            const response = await fetch(`/locrits/${encodeURIComponent(locritName)}/toggle`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            const result = await response.json();

            if (result.success) {
                window.location.reload();
            } else {
                alert('Erreur: ' + (result.error || 'Erreur inconnue'));
                this.innerHTML = originalText;
                this.disabled = false;
            }
        } catch (error) {
            console.error('Erreur:', error);
            alert('Erreur de connexion');
            this.innerHTML = originalText;
            this.disabled = false;
        }
    });
});

// View details toggle
document.querySelectorAll('.view-details').forEach((button, index) => {
    button.addEventListener('click', function() {
        const detailsRow = document.getElementById(`details-${index + 1}`);
        if (detailsRow.style.display === 'none') {
            detailsRow.style.display = 'table-row';
            this.innerHTML = 'üìÅ';
            this.title = 'Masquer les d√©tails';
        } else {
            detailsRow.style.display = 'none';
            this.innerHTML = 'üìÑ';
            this.title = 'Voir les d√©tails';
        }
    });
});

// Delete Locrit
let locritToDelete = null;
const deleteModal = document.getElementById('deleteModal');
const deleteLocritName = document.getElementById('deleteLocritName');
const cancelDelete = document.getElementById('cancelDelete');
const confirmDelete = document.getElementById('confirmDelete');

document.querySelectorAll('.delete-locrit').forEach(button => {
    button.addEventListener('click', function() {
        locritToDelete = this.dataset.locrit;
        deleteLocritName.textContent = locritToDelete;
        deleteModal.style.display = 'block';
    });
});

cancelDelete.addEventListener('click', function() {
    deleteModal.style.display = 'none';
    locritToDelete = null;
});

confirmDelete.addEventListener('click', function() {
    if (locritToDelete) {
        // Create a form and submit it
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/locrits/${encodeURIComponent(locritToDelete)}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
});

// Close modal when clicking outside
deleteModal.addEventListener('click', function(e) {
    if (e.target === deleteModal) {
        deleteModal.style.display = 'none';
        locritToDelete = null;
    }
});
</script>
{% endblock %}